<?php

define('AREA_ACCESS', 'area access');
define('AREA_CREATE', 'area create');

/**********************************
 *  Hook implementations
 *********************************/

/**
 * Implements hook_help()
 *
 * @param $path
 * @param $arg
 * @return string
 */
function area_help($path, $arg) {
  switch ($path) {
    case "admin/help#area":
      return '<p>'.  t("Area module") .'</p>';
      break;
  }
}

/**
 * Implements hook_menu()
 *
 * @return array
 */
function area_menu() {
  $items['area'] = array(
    'title' => t('Areas'),
    'description' => t('List of areas'),
    'page callback' => 'show_area_search',
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'area.search.inc',
  );
  $items['area/%'] = array(
    'title' => t('Area'),
    'description' => t('View an area'),
    'page callback' => 'show_area',
    'page arguments' => array(1),
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_NORMAL_ITEM,
    'file' => 'area.inc',
  );
  $items['area/%/normal'] = array(
    'title' => t('Normal'),
    'description' => t('Normal view of an area'),
    'page callback' => 'show_area',
    'page arguments' => array(1),
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_DEFAULT_LOCAL_TASK | MENU_NORMAL_ITEM,
    'context' => MENU_CONTEXT_PAGE | MENU_CONTEXT_INLINE,
    'file' => 'area.inc',
    'weight' => 1
  );
  $items['area/%/gallery'] = array(
    'title' => t('Gallery'),
    'description' => t('View the area as a gallery of organisms'),
    'page callback' => 'show_area_gallery',
    'page arguments' => array(1),
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_LOCAL_TASK | MENU_NORMAL_ITEM,
    'context' => MENU_CONTEXT_PAGE | MENU_CONTEXT_INLINE,
    'file' => 'area.inc',
    'weight' => 2
  );
  $items['area/new'] = array(
    'title' => 'Create new area',
    'description' => 'Create an area',
    'page callback' => 'area_new',
    'access arguments' => array(AREA_CREATE),
    'type' => MENU_CALLBACK,
    'file' => 'area.new.inc',
  );
  $items['area/gmap_image_redirect/%'] = array(
    'title' => 'Redirect to Google Maps static image URL',
    'description' => 'Google Maps static image redirect',
    'page callback' => 'googlemaps_static_redirect',
    'page arguments' => array(2),
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_CALLBACK,
    'file' => 'area.search.inc',
  );
  $items['area/habitat_autocomplete'] = array(
    'title' => 'Habitat autocomplete',
    'page callback' => 'area_habitat_autocomplete',
    'access arguments' => array(AREA_CREATE),
    'type' => MENU_CALLBACK,
    'file' => 'area.ajax.inc',
  );
  $items['area/area_saved_autocomplete'] = array(
    'title' => 'Area autocomplete',
    'page callback' => 'area_saved_autocomplete',
    'access arguments' => array(AREA_CREATE),
    'type' => MENU_CALLBACK,
    'file' => 'area.ajax.inc',
  );
  $items['area/json'] = array(
    'title' => 'area information in json format',
    'page callback' => 'area_json',
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_CALLBACK,
    'file' => 'area.ajax.inc',
  );
  $items['area/getareas'] = array(
    'title' => 'area information in json format',
    'page callback' => 'get_areas',
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_CALLBACK,
    'file' => 'area.ajax.inc',
  );
  $items['area/datatable'] = array(
    'title' => 'area information in json format for datatable',
    'page callback' => 'area_datatable',
    'access arguments' => array(AREA_ACCESS),
    'type' => MENU_CALLBACK,
    'file' => 'area.ajax.inc',
  );

  return $items;
}

/**
 * Implements hook_theme()
 *
 * @return an array with theme template information
 */
function area_theme() {
  return array(
    'area.new' => array(
      'template' => 'area.new',
      'variables' => array()
    ),
    'area.search' => array(
      'template' => 'area.search',
      'variables' => array()
    ),
    'area.search.byMaps' => array(
      'template' => 'area.search.byMaps',
      'variables' => array()
    ),
    'area.search.byMaps.show' => array(
      'template' => 'area.search.byMaps.show',
      'variables' => array()
    ),
  );
}

function area_permission() {
  return array(
    AREA_ACCESS =>  array(
      'title' => t('can view areas'),
    ),
    AREA_CREATE =>  array(
      'title' => t('can create areas'),
    ),
  );
}

/**
 * Implements hook of gallery module to activate the gallery
 * functionality for area
 * 
 * @return array
 */
function area_gallery_types() {
  return array(
    'area' => array(
      'edit_gallery' => 'gallery_owner_access_callback',
      'image_caption' => 'area_gallery_image_caption'
    )
  );
}

/**
 * Helper function referenced in area_gallery_types to define the caption
 * for images added to intentory entries
 * 
 * @param $id
 * @return string
 */
function area_gallery_image_caption($id) {
  $result = db_select('area', 'a')
    ->condition('id', $id)
    ->fields('a')
    ->execute()
    ->fetch();
  return $result->field_name.' <small>'.$result->locality.' '.$result->canton.', '.$result->country.'</small>';
}

/**
 * Implements hook of gallery module to define the different category
 * conditions available for area types
 * 
 * @return array
 */
function area_gallery_category_conditions() {
  return array(
    'area' => array(
      'name' => t('Areas'),
      'type' => 'area'
    ),
  );
}

?>